# Analysis
Data Visualiization and Analysis from the data collected in the previous steps from jobs.ch and itjobs.ch. 
Some of the job listings are rated from a scale from 0,9 according to my interests and qualifications.

## Import Data
```{r, message=FALSE, warning=FALSE}
library(tidyverse)
library(jsonlite)
library(lubridate)
```
```{r}

raw_df <- fromJSON("../data/jobs_processed.json")
raw_df <- bind_rows(raw_df)
glimpse(raw_df)
```

## Clean Data
```{r, error=TRUE, warning=TRUE}
# convert datatypes
df <- raw_df %>%
    mutate(publication_date = dmy(publication_date), 
        job_title_cleaned = factor(job_title_cleaned),
        career_stage_cleaned = factor(career_stage_cleaned),
        canton = factor(canton),
        programming_languages = lapply(programming_languages, factor),
        frameworks = lapply(frameworks, factor),
        tools = lapply(tools, factor),
        operating_systems = lapply(operating_systems, factor),
        max_years = sapply(years, function(x) if (length(x) == 0) NaN else max(as.numeric(x), na.rm = TRUE))) # get min number of years, and replace nan with 0

colSums(is.na(df))

```

Check if some IT key words in listing title were missed during preprocessing, and therefore have a NaN value in the `job_title_cleaned` attribute. 
```{r, error=TRUE, warning=TRUE}
df %>%
  filter(is.na(job_title_cleaned)) %>%
  slice_head(n = 20) %>%
  pull(job_title) 
```
```{r, error=TRUE, warning=TRUE}
# drop NaN rows
df <- df %>%
    filter(!is.na(job_title_cleaned) & !is.na(publication_date))%>%# drop rows with no cleaned job title, since they are probably no IT related jobs 
    filter(publication_date > as.Date("2025-01-01"))%>%
    filter(max_years <= 20) # outliers

    
glimpse(df)
```



## Visualize
```{r, error=TRUE, warning=TRUE}
df %>%
  count(publication_date) %>%
  ggplot(aes(publication_date, n)) +
  geom_line(aes(color = "All Listings"), linewidth = 1, alpha=0.5) +  # Line for all listings
  geom_line(data = df %>% filter(reviewed == TRUE) %>% count(publication_date), 
            aes(publication_date, n, color = "Reviewed Listings"), linewidth = 1, alpha=0.5) +  # Line for reviewed listings
  labs(title = "Number of scraped IT Job Listings per Day",
       x = "Date",
       y = "") +
    scale_color_manual(name = "Legend", values = c("All Listings" = "blue", "Reviewed Listings" = "red"))

```
```{r, error=TRUE, warning=TRUE}
df %>%
  ggplot() +
  geom_bar(mapping=aes(x=rating), alpha = 0.7)+
  labs(x = "Rating",
       y = "Count") 

```
```{r, error=TRUE, warning=TRUE}
df %>%
  ggplot() +
  geom_bar(mapping=aes(y=job_category), alpha = 0.7)+
  labs(y = "Job Category",
       x = "Count") 

```
```{r, error=TRUE, warning=TRUE}
p <- ggplot(df, aes(max_years, career_stage_cleaned))  +
    geom_boxplot() +
    labs(y = "Career Stage",
        x = "Min years of experience") 
print(p)
```

```{r, error=TRUE, warning=TRUE}
df %>%
    unnest(programming_languages) %>%         # Unnest the list column
    count(programming_languages) %>%           # Count occurrences of each language
    ggplot(aes(x = n, y = programming_languages)) +  
    geom_bar(stat = "identity", alpha = 0.7) +
    labs(x = "Count", y = "Programming Language")

```
```{r, error=TRUE, warning=TRUE}
df %>%
    count(search_query) 
```
```{r, error=TRUE, warning=TRUE}
df %>%
    count(job_title_cleaned) 
```
```{r, error=TRUE, warning=TRUE}
df %>%
    count(job_category) 
```
